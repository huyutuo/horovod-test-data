### 协调过程同步节点间延迟损耗时间计算
设传输过程中数据总量为D，带宽为B，K为节点数，S为allreduce模式传输时数据拆分的个数，节点间的延迟为α。
PS模式传输时的时间近似为`2(D/B + α)`
allreduce传输时的时间近似为`2(K - 1)(α + D/(KB)) = 2(K-1) * α + 2(K-1)*D/(KB)`，当节点个数较多时 ≈ `2(K-1) * α + 2*D/B`
两种模式的差值为`2(K-1) * α - 2*α = 2(K - 2) * α `

在之前测试使用的阿里云实例`ecs.gn6e-c12g1.12xlarge`中，节点间的平均延迟为0.14ms。当节点个数为128个时，allreduce模式所花费的时间要比ps模式多损耗35ms。

### response cache 大小计算
在horovod中，一个tensor所对应的数据结构所占内存大约为**88B**，resnet50中约为**20000**个tensor，所有tensor全部使用response cache来进行协调，则需要占用内存约**1.8GB**。 在协调过程中采用bit_vector形式(一个tensor对应一个bit)来进行传输需要内存**2.5MB**。


### ps、allreduce模式下传输比较
5Gbps的带宽下，数据传输时间为`2.5M/5Gbps = 4ms`
128个节点进行训练时，ps模式下数据传输时间占比为（4/(4+2*0.14) = 93.5%
allreduce模式下传输时间占比约为`(4/(4 + 2*127*0.14) ` = 10%
可以看出通过allreduce模式进行传输时，当传输数据比较小时，传输时间占比会比PS模式低很多。