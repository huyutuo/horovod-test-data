# 实验记录
## 机器硬件配置
|实例规格| vCPU	内存（GiB）|内存（GiB）| GPU  | GPU显存（GB）  | 网络带宽能力（出+入）（Gbit/s）  |  网络收发包能力（出+入）（万PPS） |
|---|---|---|---|---|---|---|
|  ecs.gn6e-c12g1.2xlarge |48  |  368.0 | V100*4  | 128  | 16.0 | 240|
## 软件环境
|软件|版本|
|---|---|
|horovod|0.20.3|
|mpi|4.1.0|
|nccl|2.8.3|
## 其余设置
4个节点，每个节点使用1块GPU

**每个实验50个epoch，每个epoch 50个batch**

**batch size=32**

## 实验目的
在horovod中设置不同的nccl中thread、socket数目，观察训练速度以及训练时间的变化

# 实验数据
## 实验数据说明
Si—Ti代表使用的线程数目与socket数目，数据中未含有Si-Ti为默认设置，S为1，T为1.

**速率定义：每个response的大小除传输的时间得到一个速率，将处在同一区间的response进行求平均（速率相加然后除总个数），求得速率的平均值**

**总时间定义：整个训练的持续时间**

**第一列定义:horovod中response的大小**

## 详细实验数据

### resnet50
12-24-15-resnet50-16G-e50-b50_rank_0  

训练总时间: 391.1S（**单个batch平均时长：156.4ms**）

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|1|0.00|14.47|0.00|0.81|0.00%|
|(1KB, 1MB]|1529|0.35|3995.06|1.39|0.91|0.65%|
|(1MB, 10MB]|2635|4.39|13994.54|9.79|3.71|4.61%|
|(10MB, 20MB]|1823|15.80|14413.28|24.28|13.32|11.44%|
|(20MB, 30MB]|2854|24.19|13782.90|60.59|21.23|28.54%|
|(30MB, 40MB]|1434|36.23|13756.04|45.61|31.81|21.49%|
|(40MB, 50MB]|1560|44.58|13985.25|59.94|38.42|28.24%|
|(50MB, 60MB]|189|54.14|13834.89|8.90|47.10|4.19%|
|(60MB, 70MB]|33|61.65|13819.00|1.78|53.84|0.84%|

01-25-21-resnet50-S2-T2-e50-b50_rank_0
训练总时间：367.9s（**单个batch平均时长：147.2ms**）

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|1|0.00|838.74|0.00|0.74|0.00%|
|(1KB, 1MB]|1984|0.32|2683.27|2.54|1.28|1.38%|
|(1MB, 10MB]|3353|4.81|13787.31|13.80|4.12|7.49%|
|(10MB, 20MB]|1653|14.47|16309.83|17.88|10.82|9.71%|
|(20MB, 30MB]|2966|23.05|16064.01|51.07|17.22|27.73%|
|(30MB, 40MB]|331|36.64|16213.64|8.98|27.13|4.88%|
|(40MB, 50MB]|1028|46.19|16348.43|34.90|33.95|18.95%|
|(50MB, 60MB]|833|55.23|16336.29|33.82|40.59|18.36%|
|(60MB, 70MB]|472|61.60|16613.25|21.18|44.86|11.50%|



01-25-21-resnet50-S4-T4-e50-b50_rank_0
训练总时间:372.1s（**单个batch平均时长：148.9ms**）

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|1|0.00|27.84|0.00|0.42|0.00%|
|(1KB, 1MB]|2124|0.45|1435.48|8.14|3.83|4.98%|
|(1MB, 10MB]|4380|4.89|12856.29|20.21|4.61|12.37%|
|(10MB, 20MB]|2487|14.52|18752.27|23.39|9.40|14.32%|
|(20MB, 30MB]|1710|23.69|19026.89|25.66|15.00|15.71%|
|(30MB, 40MB]|160|34.98|19780.68|3.42|21.34|2.09%|
|(40MB, 50MB]|368|45.81|20064.37|10.14|27.56|6.21%|
|(50MB, 60MB]|773|55.61|19903.09|25.99|33.63|15.91%|
|(60MB, 70MB]|1270|62.39|20539.33|46.38|36.52|28.40%|

### vgg16
12-24-15-vgg16-16G-e50-b50_rank_0
训练总时间：1253.3S（**单个batch平均时长：501.3ms**）

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(1KB, 1MB]|3756|0.10|1220.76|3.15|0.84|0.31%|
|(1MB, 10MB]|583|8.16|15525.94|3.63|6.22|0.35%|
|(10MB, 20MB]|3185|16.00|13396.60|45.95|14.43|4.46%|
|(20MB, 30MB]|1478|26.55|15934.00|29.50|19.96|2.87%|
|(30MB, 40MB]|896|37.43|15780.92|25.52|28.48|2.48%|
|(40MB, 50MB]|566|46.64|16139.29|19.64|34.70|1.91%|
|(50MB, 60MB]|440|55.24|16014.14|18.23|41.44|1.77%|
|(60MB, 70MB]|2500|64.00|14781.93|130.15|52.06|12.64%|
|(350MB, 400MB]|2500|392.00|15623.61|753.60|301.44|73.21%|

01-25-21-vgg16-S2-T2-e50-b50_rank_0
训练总时间：1098s（**单个batch平均时长：439.2ms**）

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|1|0.00|12.41|0.00|0.47|0.00%|
|(1KB, 1MB]|4587|0.16|1624.03|4.30|0.94|0.49%|
|(1MB, 10MB]|725|6.87|15881.53|3.61|4.98|0.41%|
|(10MB, 20MB]|2911|15.88|18360.14|30.60|10.51|3.50%|
|(20MB, 30MB]|680|26.35|18164.04|11.84|17.41|1.36%|
|(30MB, 40MB]|515|37.49|18000.49|12.90|25.05|1.48%|
|(40MB, 50MB]|525|46.84|18697.78|16.00|30.48|1.83%|
|(50MB, 60MB]|1193|55.17|18225.23|43.59|36.54|4.99%|
|(60MB, 70MB]|2500|64.00|18070.28|107.31|42.93|12.29%|
|(350MB, 400MB]|2500|392.00|18325.01|643.16|257.26|73.64%|




01-25-21-vgg16-S4-T4-e50-b50_rank_0
训练总时间：1081s（**单个batch平均时长：432.4ms**）

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|2|0.00|199.90|0.00|0.42|0.00%|
|(1KB, 1MB]|4439|0.19|1668.48|4.82|1.08|0.56%|
|(1MB, 10MB]|1125|5.17|14935.53|4.38|3.89|0.51%|
|(10MB, 20MB]|2819|15.76|19170.17|28.40|10.07|3.33%|
|(20MB, 30MB]|481|26.71|18919.58|8.17|16.98|0.96%|
|(30MB, 40MB]|340|37.36|18668.43|8.37|24.61|0.98%|
|(40MB, 50MB]|507|46.88|19007.07|15.41|30.39|1.81%|
|(50MB, 60MB]|1452|54.47|18905.59|50.99|35.12|5.98%|
|(60MB, 70MB]|2500|64.00|18836.96|103.03|41.21|12.08%|
|(350MB, 400MB]|2499|392.00|18731.04|629.33|251.83|73.79%|
