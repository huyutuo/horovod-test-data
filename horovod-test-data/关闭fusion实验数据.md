#  实验记录
## 机器硬件配置
|实例规格| vCPU	内存（GiB）|内存（GiB）| GPU  | GPU显存（GB）  | 网络带宽能力（出+入）（Gbit/s）  |  网络收发包能力（出+入）（万PPS） |
|---|---|---|---|---|---|---|
|  ecs.gn6e-c12g1.2xlarge |48  |  368.0 | V100*4  | 128  | 16.0 | 240|
## 软件环境
|软件|版本|
|---|---|
|horovod|0.20.3|
|mpi|4.1.0|
|nccl|2.8.3|
## 其余设置
4个节点，每个节点使用1块GPU, 共 4*1 = 4 块GPU

**每个实验20个epoch，每个epoch 20个batch**

**batch size=32**

## 实验目的
比较在实验中开启fusion与关闭fusion的训练速度比较
# 实验数据
## 实验数据说明
实验的线程与socket数目均为1

**速率定义：每个response的大小除传输的时间得到一个速率，将处在同一区间的response进行求平均（速率相加然后除总个数），求得速率的平均值**

**总时间定义：整个训练的持续时间**

**第一列定义:horovod中response的大小**


## resnet50
03-10-13-resnet50-e20-b20_rank_0

**训练总时间119.8s, 单个batch 299.5ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(1KB, 1MB]|117|0.46|4630.69|0.12|1.06|0.16%|
|(1MB, 10MB]|391|3.32|6588.35|2.57|6.57|3.30%|
|(10MB, 20MB]|364|16.14|6211.20|11.72|32.19|15.04%|
|(20MB, 30MB]|300|25.66|6062.00|15.40|51.32|19.77%|
|(30MB, 40MB]|193|35.71|6068.18|13.71|71.04|17.60%|
|(40MB, 50MB]|249|46.06|6107.48|22.59|90.74|29.01%|
|(50MB, 60MB]|44|53.98|5967.76|4.79|108.95|6.15%|
|(60MB, 70MB]|53|62.90|5747.27|6.98|131.70|8.96%|




03-10-13-resnet50-e20-b20-fusion0_rank_0

**训练总时间141.0s, 单个batch 352.5ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|24800|0.00|32.04|7.46|0.30|7.42%|
|(1KB, 1MB]|32392|0.21|1781.57|25.97|0.80|25.85%|
|(1MB, 10MB]|7198|4.46|6195.96|67.03|9.31|66.72%|




03-10-13-vgg16-e20-b20_rank_0

**训练总时间314.7s, 单个batch 786.8ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(1KB, 1MB]|521|0.04|664.10|0.29|0.56|0.11%|
|(1MB, 10MB]|44|6.56|9688.96|0.36|8.13|0.13%|
|(10MB, 20MB]|515|15.74|8731.78|11.22|21.79|4.19%|
|(20MB, 30MB]|384|26.23|9372.95|12.91|33.63|4.82%|
|(30MB, 40MB]|170|36.98|9231.33|8.36|49.17|3.12%|
|(40MB, 50MB]|60|46.22|9275.27|3.60|59.95|1.34%|
|(50MB, 60MB]|22|53.76|9490.27|1.50|68.05|0.56%|
|(60MB, 70MB]|400|64.00|9536.13|32.27|80.67|12.05%|
|(350MB, 400MB]|400|392.00|9537.35|197.31|493.28|73.67%|




03-10-13-vgg16-e20-b20-fusion0_rank_0

**训练总时间317.5s, 单个batch 793.7ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|8398|0.00|33.87|2.42|0.29|0.90%|
|(1KB, 1MB]|10000|0.04|501.11|5.06|0.51|1.87%|
|(1MB, 10MB]|3599|6.13|17425.63|27.63|7.68|10.21%|
|(10MB, 20MB]|400|15.62|8643.13|8.71|21.77|3.22%|
|(60MB, 70MB]|400|64.00|9206.99|33.44|83.59|12.36%|
|(350MB, 400MB]|400|392.00|9719.60|193.30|483.26|71.45%|
