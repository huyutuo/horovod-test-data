# # 实验记录
## 机器硬件配置
|实例规格| vCPU	内存（GiB）|内存（GiB）| GPU  | GPU显存（GB）  | 网络带宽能力（出+入）（Gbit/s）  |  网络收发包能力（出+入）（万PPS） |
|---|---|---|---|---|---|---|
|  ecs.gn6e-c12g1.2xlarge |48  |  368.0 | V100*4  | 128  | 16.0 | 240|
## 软件环境
|软件|版本|
|---|---|
|horovod|0.20.3|
|mpi|4.1.0|
|nccl|2.8.3|
## 其余设置
4个节点，每个节点使用4块GPU, 共 4*4 = 16 块GPU

**每个实验100个epoch，每个epoch 10个batch**

**batch size=32**

## 实验目的
比较在实验中是否开启hierarchical-allreduce与hierarchical-allgather的区别

# 实验数据
## 实验数据说明
实验的线程与socket数目均为1

**速率定义：每个response的大小除传输的时间得到一个速率，将处在同一区间的response进行求平均（速率相加然后除总个数），求得速率的平均值**

**总时间定义：整个训练的持续时间**

**第一列定义:horovod中response的大小**

因log文件格式不同，开启hierarchical的详细实验数据未能获取

## resnet50
01-27-12-resnet50-e100-b10-gpu16_rank_0
**训练总时间263.8s, 单个batch 263.8ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(0, 1KB]|2|0.00|4016.73|0.02|9.79|0.02%|
|(1KB, 1MB]|1259|0.48|5041.90|2.05|1.63|1.68%|
|(1MB, 10MB]|2707|4.20|13721.83|19.41|7.17|15.96%|
|(10MB, 20MB]|1162|14.20|8906.03|22.94|19.74|18.86%|
|(20MB, 30MB]|893|24.71|9905.48|27.51|30.80|22.62%|
|(30MB, 40MB]|364|35.04|10715.22|14.45|39.70|11.88%|
|(40MB, 50MB]|302|44.39|11680.95|13.92|46.08|11.44%|
|(50MB, 60MB]|164|53.95|11815.56|9.04|55.13|7.43%|
|(60MB, 70MB]|190|62.90|11744.29|12.29|64.70|10.11%|



01-27-12-resnet50-hierarchical-e100-b10-gpu16_rank_0
**训练总时间256.9s, 平均每个batch 256.9ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|



## vgg16
01-27-12-vgg16-e100-b10-gpu16_rank_0
**训练总时间881.1s, 平均每个batch 881.1ms**

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|
|(1KB, 1MB]|1411|0.11|415.57|4.25|3.01|0.58%|
|(1MB, 10MB]|565|5.61|7086.83|5.20|9.20|0.71%|
|(10MB, 20MB]|1229|15.34|8652.68|26.26|21.37|3.60%|
|(20MB, 30MB]|324|24.07|8924.18|10.48|32.36|1.44%|
|(30MB, 40MB]|186|36.03|9095.22|8.85|47.55|1.21%|
|(40MB, 50MB]|357|47.43|9149.92|22.22|62.25|3.05%|
|(50MB, 60MB]|339|53.65|9148.51|23.86|70.39|3.27%|
|(60MB, 70MB]|1000|64.00|9161.45|83.88|83.88|11.50%|
|(350MB, 400MB]|1000|392.00|8648.94|544.30|544.30|74.63%|



 797.0
01-27-12-vgg16-hierarchical-e100-b10-gpu16_rank_0
训练总时间797s, 平均每个batch 797ms

|   |个数|平均大小/MB|速率/Mbps|总时间/s|平均时间/ms|时间占比|
|---|---|---|---|---|---|---|